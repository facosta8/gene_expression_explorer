gene <- read_csv('../ejemplo/matriz_ejemplo.csv')
library(tidyverse)
gene <- read_csv('../ejemplo/matriz_ejemplo.csv')
# aquí la estandarizo
gene_est <- t(scale(t(gene[,-1])))
gene_est <- as.data.frame(gene_est)
gene_est$X1 <- gene$X1
len_pa <- ncol(gene_est)-1
set.seed(101021)
hashes <- lapply(1:200, function(i){
v <- rnorm(len_pa)
function(x){
ifelse(sum(v*x) >= 0, 1, -1)
}
})
x <- as.numeric(df[1,-1])
# aquí la estandarizo
gene_est <- t(scale(t(gene[,-1])))
gene_est <- as.data.frame(gene_est)
gene_est$X1 <- gene$X1
len_pa <- ncol(gene_est)-1
set.seed(101021)
hashes <- lapply(1:200, function(i){
v <- rnorm(len_pa)
function(x){
ifelse(sum(v*x) >= 0, 1, -1)
}
})
x <- as.numeric(df[1,-1])
# aquí la estandarizo
gene_est <- t(scale(t(gene[,-1])))
gene_est <- as.data.frame(gene_est)
gene_est$X1 <- gene$X1
len_pa <- ncol(gene_est)-1
set.seed(101021)
hashes <- lapply(1:200, function(i){
v <- rnorm(len_pa)
function(x){
ifelse(sum(v*x) >= 0, 1, -1)
}
})
x <- as.numeric(gene_est[1,-1])
sapply(hashes, function(f) f(x))
len_pa <- ncol(gene)-1
set.seed(101021)
hashes <- lapply(1:200, function(i){
v <- rnorm(len_pa)
function(x){
ifelse(sum(v*x) >= 0, 1, -1)
}
})
x <- as.numeric(gene[1,-1])
sapply(hashes, function(f) f(x))
View(gene)
# aquí la estandarizo
gene_est <- t(scale(t(gene[,-1])))
gene_est <- as.data.frame(gene_est)
gene_est$X1 <- gene$X1
len_pa <- ncol(gene_est)-1
set.seed(101021)
hashes <- lapply(1:200, function(i){
v <- rnorm(len_pa)
function(x){
ifelse(sum(v*x) >= 0, 1, -1)
}
})
View(gene_est)
moveme(names(gene_est),'X1')
gene_est <- gene_est %>% select(X1, everything())
View(gene_est)
# aquí la estandarizo
gene_est <- t(scale(t(gene[,-1])))
gene_est <- as.data.frame(gene_est)
gene_est$X1 <- gene$X1
gene_est <- gene_est %>% select(X1, everything())
len_pa <- ncol(gene_est)-1
set.seed(101021)
hashes <- lapply(1:200, function(i){
v <- rnorm(len_pa)
function(x){
ifelse(sum(v*x) >= 0, 1, -1)
}
})
x <- as.numeric(gene_est[1,-1])
sapply(hashes, function(f) f(x))
df_agrup <- gene_est %>% gather('variable', 'valor', -X1) %>%
group_by(X1) %>%
arrange(variable) %>%
summarise(vec_1 = list(valor))
df_hash <- df_agrup %>%
mutate(gene_est = map(vec_1, function(x){
firma <-  sapply(hashes, function(f) f(x))
data_frame(id_hash = 1:length(firma),
firma = firma) })) %>%
select(-vec_1) %>% unnest
df_hash
f_1 <- function(x){
1-(1-((180-x)/180)^10)^20
}
curve(f_1, 0, 180)
abline(v=20)
df_hash_1 <- df_hash %>%
mutate(banda  = (id_hash - 1) %% 20 + 1) %>%
mutate(h = paste(id_hash,firma)) %>%
arrange(X1)
df_hash_1
cubetas <- df_hash_1 %>%
group_by(X1, banda) %>%
summarise(cubeta = paste(h, collapse = '/'))
cubetas
cubetas_hash <- cubetas %>%
ungroup %>% rowwise %>%
mutate(cubeta = digest::digest(cubeta))
cubetas_hash
cubetas_agrup <- cubetas_hash %>% group_by(cubeta) %>%
summarise(ids = list(X1)) %>%
mutate(num_ids = map_dbl(ids, length)) %>%
filter(num_ids > 1 )
cubetas_agrup
pares_candidatos <- lapply(cubetas_agrup$ids, function(x){
combn(sort(x), 2, simplify = FALSE)}) %>%
flatten %>% unique %>%
transpose %>% lapply(as.integer) %>% as.data.frame
